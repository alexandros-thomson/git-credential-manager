# .github/workflows/copilot-badge-updater.yml
name: üìú Copilot Badge Updater

on:
  issues:
    types: [opened]
    # optional: filter by label
    # filters:
    #   labels: ["auto-badge"]

jobs:
  assign-and-update:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: write

    steps:
      - name: Assign issue to Copilot
        uses: peter-evans/assign-issue@v3
        with:
          assignees: github-actions[bot]

      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Generate Updated Badge
        run: |
          # invoke Copilot via GitHub CLI (beta)
          gh issue comment ${{ github.event.issue.number }} \
            --body "/copilot edit: update badge for workflow changes"

      - name: Wait for Copilot Commit
        run: |
          echo "‚è≥ Waiting for Copilot agent to commit changes‚Ä¶"
          sleep 30  # adjust as needed

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "chore(ci): Copilot-updated badge"
          title: "chore: badge update via Copilot"
          body: "This PR was created by Copilot in response to #${{ github.event.issue.number }}."{%- assign repo   = include.repo   | default: site.github.repository_owner | append: "/" | append: site.github.repository_name -%}
{%- assign file   = include.file   | default: "mythic-sigil-pipeline.yml" -%}
{%- assign branch = include.branch | default: "main"                      -%}
{%- assign label  = include.label  | default: "Sigil Pipeline"           -%}
{%- assign style  = include.style  | default: "flat-square"              -%}
{%- assign color  = include.color  | default: "brightgreen"              -%}
{%- assign alt    = include.alt    | default: label                      -%}

<a href="https://github.com/{{ repo }}/actions">
  <img
    src="https://img.shields.io/github/actions/workflow/status/{{ repo }}/{{ file }}?branch={{ branch }}&label={{ label | uri_escape }}&style={{ style }}&color={{ color }}"
    alt="{{ alt }}"
  >
</a>